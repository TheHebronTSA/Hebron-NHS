define("formCommon",["lodash","utils","core","santaProps","prop-types","reactDOM"],function(e,t,s,i,r,o){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1369)}({0:function(t,s){t.exports=e},1:function(e,s){e.exports=t},12:function(e,t){e.exports=o},1369:function(e,t,s){var i,r;i=[s(1370)],void 0===(r=function(e){"use strict";return{formMixin:e}}.apply(t,i))||(e.exports=r)},1370:function(e,t,s){var i,r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i=[s(0),s(3),s(2),s(1),s(1371),s(1373),s(12),s(5)],void 0===(r=function(e,t,s,i,r,n,a,p){"use strict";var l=s.compMixins,c=i.cookieUtils,d=i.dateTimeUtils,u=i.ajaxLibrary,m="wixClient";function h(e,t,s,i,r,o,n,a,p,l,c){return c?{metaSiteId:o||"dc853130-4fb2-464f-878d-3b6667dc4f97",to:[{address:s,name:s}],bcc:i?{address:i,name:i}:null,from:{address:e,name:t},contactPhone:a,contactAddress:l,formSubject:p,formMessage:n}:{to:[{address:s,personal:s}],bcc:i?[{address:i||"n/a",personal:i||"n/a"}]:[],cc:[],from:{address:e,personal:t},subject:r,metaSiteId:o||"dc853130-4fb2-464f-878d-3b6667dc4f97",plainTextMessage:"n/a"}}function y(){var t=void 0,s=void 0,i=this.props.isPremiumUser,r=this.getFormFields.call(this),n=this.props.compData.toEmailAddress,a=this.props.compData.bccEmailAddress,p=this.getInputName(),l=this.props.metaSiteId,c=this.props.isExperimentOpen("sendContactFormEmailsViaPong"),u=this.props.compData.formName;if(r.newModel){var m=function(e){return(r.data.getAll(e)[0]||{}).value};s=r.data.displayed,t=h(m("email"),p,n,a,this.translatedKeys["subject"+(i?"_premium":"")]+" "+m("email"),l,m("message"),m("phone"),m("subject"),m("address"),c)}else s=r,t=h(this.state.email.value,p,n,a,this.translatedKeys["subject"+(i?"_premium":"")]+" "+(r.email||r.Email||r[this.props.compData.emailFieldLabel]),l,this.state.message&&this.state.message.value,this.state.phone&&this.state.phone.value,this.state.subject&&this.state.subject.value,this.state.address&&this.state.address.value,c);return e.assign(t,{componentId:this.props.id,compDataId:function(){var e=void 0,t=this.props.structure&&this.props.structure.dataQuery;switch(t&&(void 0===t?"undefined":o(t))){case"string":e=t;break;case"object":e=t.id}return(e||"").replace("#","")}.call(this),pageId:e.isEmpty(this.props.compMasterPageData)?this.props.pageId:"masterPage",siteId:this.props.siteId}),c?(t.fields=s,t):(t.htmlMessage=function(t,s,i,r){var o=new Date,n={todayDate:"<%=todayDay%> <%=todayMonthName%>, <%=todayYear%>",singleField:'<li style="list-style: none; margin: 0 0 5px 0; padding: 0;white-space: pre-wrap;"><b><%=fieldKey%></b> <%=fieldValue%></li>',outerMessage:'<ul style="list-style: none; margin: 0; padding: 0;"><li style="list-style: none; margin: 0 0 5px 0; padding: 0;"><b><%=title%></b></li><li style="list-style: none; margin: 0 0 15px 0; padding: 0;"><%=via%> <%=websiteUrl%></li><li style="list-style: none; margin: 0 0 5px 0; padding: 0;"><b><%=details%></b></li><li style="list-style: none; margin: 0 0 25px 0; padding: 0;"><ul style="margin: 0 0 0 20px; padding: 0;"><%=fields%></ul></li>'+(r?'<li style="list-style: none; margin: 0 0 15px 0; padding: 0;"><b><%=formNameLabel%></b> <%=formName%></li>':"")+'<li style="list-style: none; margin: 0 0 15px 0; padding: 0;"><b><%=sentOn%></b> <%=dateToday%></li><li style="list-style: none; margin: 0; padding: 0;"><%=thanks%></li></ul>'};return e.template(n.outerMessage)({title:this.translatedKeys.title,via:this.translatedKeys.via,websiteUrl:s,details:this.translatedKeys.details,fields:e.reduce(t,function(t,s,i){return t+e.template(n.singleField)({fieldKey:i,fieldValue:s})},""),sentOn:this.translatedKeys.sentOn,dateToday:e.template(n.todayDate)({todayDay:o.getDate(),todayMonthName:d.getMonthName(o.getMonth()),todayYear:o.getFullYear()}),formNameLabel:this.translatedKeys.formNameLabel,formName:r||this.translatedKeys.formNameNoValuePlacholder,thanks:this.translatedKeys["thanks"+(i?"_premium":"")]})}.call(this,s,this.props.externalBaseUrl||"",i,u),t)}var f="/_api/wix-common-services-webapp/notification/invoke",g="https://fallback.wix.com",b="/_api/crm-inbox-server/pong/message";function v(e,t){var s=t?b:f;if(!e){var r=window.location.protocol+"//"+window.location.hostname,o=c.getCookie(m);return"{{site}}{{service}}{{secured}}?accept=json&contentType=json&appUrl={{site}}{{cookie}}".replace(/\{\{site\}\}/g,r).replace("{{service}}",s).replace("{{cookie}}",o).replace("{{secured}}","Secured")}var n=i.urlUtils.parseUrl(e);return n.protocol+"//"+n.host+s+"?accept=json&contentType=json&appUrl="+n.protocol+"//"+n.hostname}function I(e,t){return(e||[]).reduce(function(e,s){return s[t]?e+1:e},0)}function T(t){this.props.isExperimentOpen("sv_contactFormSubmitPromoteAnalytics")&&i.integrations.promoteAnalytics.trackEvent(this.props.siteApiForPromoteAnalytics,"Lead"),this.retryCount=0,this.props.reportBI(n.FORM_SUBMIT_SUCCESS,{componentId:this.props.id,componentType:this.props.structure.componentType}),this.setState({mailSent:!0}),"message"===this.props.compData.onSubmitBehavior?function(){var e=this.props.compData.successMessage||this.translatedKeys.successMessage;this.showMessage(e)}.call(this):function(){var t=this.props.compData.link;if(t){var s=i.linkRenderer.renderLink(t,this.props.linkRenderInfo,this.props.rootNavigationInfo),r=i.wixUrlParser.parseUrl(this.props.linkRenderInfo,i.linkRenderer.getLinkUrlFromLinkProps(s));if(r){var o=t.anchorDataId;e.assign(r,{anchorData:o}),r.pageId===this.props.rootNavigationInfo.pageId?o&&this.props.scrollToAnchor(o):this.props.navigateToPage(r)}}}.call(this),function(e){return e.ignoreActivityReport||e.isTemplate}(this.props)||function(e,t,i,r,o){var n=s.activityTypes[t];n&&s.activityService.reportActivity(e,new n(r,i,o))}(this.props.activityInfo.baseUrl,t,this.getFieldsForActivityReporting(),this.props.activityInfo,this.getFieldLabels()),F.call(this),this.isBusy=!1}var S=["abort","timeout"];function _(t,s){if(this.retryCount+=1,this.shouldSubmitFallbackRequest&&e.includes(S,s)&&this.retryCount<2){var i=this.props.isExperimentOpen("sendContactFormEmailsViaPong"),o=this.props.isExperimentOpen("longer_timeouts_pong"),n=y.call(this);R(v(this.props.externalBaseUrl||"",i),JSON.stringify(n),T.bind(this,this.getActivityName()),_.bind(this),M(o))}else this.shouldSubmitFallbackRequest&&e.includes(S,s)&&this.retryCount>1?(this.props.reportBI(r.FORM_SUBMIT_FAILURE,{componentId:this.props.id,componentType:this.props.structure.componentType,errorDesc:"Unspecified error occurred, possibly a connection problem, fallback activated",response:JSON.stringify(t)}),function(){this.shouldSubmitFallbackRequest=!1;var e=y.call(this);u.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:g+f+"?accept=json&contentType=json&appUrl="+g,data:JSON.stringify(e),success:T.bind(this,this.getActivityName()),error:_.bind(this)})}.call(this)):(this.props.reportBI(r.FORM_SUBMIT_FINAL_FALLBACK,{componentId:this.props.id,componentType:this.props.structure.componentType,errorDesc:"Error occurred in Fallback Request",response:JSON.stringify(t)}),this.setState({mailSent:!1}),this.showMessage(this.translatedKeys.error,!0),this.isBusy=!1)}function F(){this.setState(this.getCleanFormState())}function M(e){return e?3e4:8e3}function R(e,t,s,i,r){u.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:e,data:t,success:s,error:i,timeout:r})}function C(t,s){this.props.biVisitorId&&this.props.reportBI(t,e.merge(s,{visitorId:this.props.biVisitorId}))}return{mixins:[l.skinBasedComp,l.timeoutsMixin],propTypes:{compMasterPageData:t.Types.ContactFormSantaTypes.compMasterPageData,siteApiForPromoteAnalytics:t.Types.ContactFormSantaTypes.siteApiForPromoteAnalytics,id:t.Types.Component.id.isRequired,pageId:t.Types.Component.pageId.isRequired,siteId:t.Types.RendererModel.siteId.isRequired,structure:t.Types.Component.structure.isRequired,compData:t.Types.Component.compData.isRequired,rootNavigationInfo:t.Types.Component.rootNavigationInfo.isRequired,shouldResetComponent:t.Types.RenderFlags.shouldResetComponent.isRequired,isMobileView:t.Types.isMobileView.isRequired,isPremiumUser:t.Types.isPremiumUser.isRequired,isTemplate:t.Types.isTemplate.isRequired,metaSiteId:t.Types.RendererModel.metaSiteId.isRequired,externalBaseUrl:t.Types.PublicModel.externalBaseUrl,scrollToAnchor:t.Types.scrollToAnchor.isRequired,navigateToPage:t.Types.navigateToPage.isRequired,reportBI:t.Types.reportBI.isRequired,linkRenderInfo:t.Types.Link.linkRenderInfo.isRequired,activityInfo:t.Types.Activity.activityInfo,ignoreActivityReport:p.bool,isExperimentOpen:t.Types.isExperimentOpen,isDynamicContactForm:t.Types.ContactFormSantaTypes.isDynamicContactForm.isRequired,userLanguage:t.Types.WixUserSantaTypes.userLanguage.isRequired,biVisitorId:t.Types.biVisitorId},getInitialState:function(){return this.shouldResetFields=this.props.shouldResetComponent,this.translatedKeys=this.getLangKeys(this.props.userLanguage||"en"),this.translatedKeys.submitting="â€¦",e.merge(this.getFormInitialState(),{$mob:this.props.isMobileView?"mobile":"desktop",$dir:this.props.compData.textDirection||"left"})},showMessage:function(e,t){this.setState({notifications:{message:e,error:!!t}})},componentWillReceiveProps:function(e){var t=this.props.shouldResetComponent;t&&t!==this.shouldResetFields&&F.call(this),this.shouldResetFields=t,this.setState({$mob:e.isMobileView?"mobile":"desktop",$dir:e.compData.textDirection||"left"})},getSkinProperties:function(){return this.state.notifications.message&&this.registerReLayout(),e.merge(this.getFormSkinProperties(this.translatedKeys),{"":{style:{height:"inherit"}},submit:{onClick:function(e){if(e.preventDefault(),this.retryCount=0,this.shouldBlockSubmit&&this.shouldBlockSubmit())this.blockSubmit(a.findDOMNode(this));else{C.call(this,n.CONTACT_FORM_CLICK_SUBMIT,{isDynamic:this.props.isDynamicContactForm});var t=this.props.compData.toEmailAddress;t&&"a33012eff368a577d48f52f310c92140"!==t||this.props.reportBI(r.FORM_SUBMIT_INVALID_EMAIL,{email:t});var s={isDynamic:this.props.isDynamicContactForm,numOfFields:I(this.props.orderedFields,"hidden"),numOfRequiredFields:I(this.props.orderedFields,"required")},i=this.isFormValid();if(!this.isBusy&&i){this.props.reportBI(n.FORM_SUBMIT,{componentId:this.props.id,componentType:this.props.structure.componentType}),C.call(this,n.CONTACT_FORM_SUBMIT_VALIDATION_SUCCESS,s),this.shouldSubmitFallbackRequest=!0,this.isBusy=!0,"message"===this.props.compData.onSubmitBehavior&&this.showMessage(this.translatedKeys.submitting);var o=this.props.isExperimentOpen("sendContactFormEmailsViaPong"),p=this.props.isExperimentOpen("longer_timeouts_pong"),l=y.call(this);R(v(this.props.externalBaseUrl||"",o),JSON.stringify(l),T.bind(this,this.getActivityName()),_.bind(this),M(p))}else i||C.call(this,n.CONTACT_FORM_SUBMIT_VALIDATION_FAILURE,s)}}.bind(this),children:this.props.compData.submitButtonLabel||"Send"}})}}}.apply(t,i))||(e.exports=r)},1371:function(e,t,s){var i,r;i=[s(1372),s(0),s(1)],void 0===(r=function(e,t,s){"use strict";return t.forEach(e,function(e,t){e.errorName=t}),s.logger.register("forms","error",e),e}.apply(t,i))||(e.exports=r)},1372:function(e){e.exports={FORM_SUBMIT_FAILURE:{errorCode:101027,severity:"error",params:{p1:"componentId",p2:"componentType",p3:"errorDesc",p4:"response"}},FORM_SUBMIT_FINAL_FALLBACK:{errorCode:101028,severity:"fatal",params:{p1:"componentId",p2:"componentType",p3:"errorDesc",p4:"response"}},FORM_SUBMIT_INVALID_EMAIL:{errorCode:101029,severity:"error",params:{p1:"email"}}}},1373:function(e,t,s){var i,r;i=[s(1374),s(1)],void 0===(r=function(e,t){"use strict";return t.logger.register("components","event",e),e}.apply(t,i))||(e.exports=r)},1374:function(e){e.exports={FORM_SUBMIT:{eventId:100,adapter:"ugc-viewer",params:{c1:"componentId",c2:"componentType"}},FORM_SUBMIT_SUCCESS:{eventId:367,adapter:"ugc-viewer",params:{component_id:"componentId",component_type:"componentType"}},CONTACT_FORM_CLICK_SUBMIT:{eventId:712,adapter:"contact-form",src:5,params:{is_dynamic:"isDynamic",visitor_id:"visitorId"}},CONTACT_FORM_SUBMIT_VALIDATION_SUCCESS:{eventId:713,adapter:"contact-form",src:5,params:{is_dynamic:"isDynamic",num_of_required_fields:"numOfRequiredFields",num_of_fields:"numOfFields",visitor_id:"visitorId"}},CONTACT_FORM_SUBMIT_VALIDATION_FAILURE:{eventId:714,adapter:"contact-form",src:5,params:{is_dynamic:"isDynamic",num_of_required_fields:"numOfRequiredFields",num_of_fields:"numOfFields",visitor_id:"visitorId"}}}},2:function(e,t){e.exports=s},3:function(e,t){e.exports=i},5:function(e,t){e.exports=r}})});
//# sourceMappingURL=formCommon.min.js.map