define("backgroundCommon",["lodash","utils","core","santaProps","coreUtils","prop-types","santa-components","skins","imageClientLib","color","pmrpc"],function(e,t,i,o,s,a,n,r,p,d,l){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(o,s,function(t){return e[t]}.bind(null,s));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=692)}({0:function(t,i){t.exports=e},1:function(e,i){e.exports=t},2:function(e,t){e.exports=i},27:function(e,t){e.exports=p},3:function(e,t){e.exports=o},339:function(e,t,i){var o,s;o=[i(0),i(5),i(2),i(6),i(3)],void 0===(s=function(e,t,i,o,s){"use strict";var a=i.compMixins,n=o.components.imageCommon.imageElements;return{displayName:"bgImage",mixins:[a.skinBasedComp],propTypes:{cssFiltersSupported:s.Types.BrowserFlags.cssFiltersSupported.isRequired,compData:t.object.isRequired,"data-type":t.string.isRequired,filterEffect:t.object},extendWithFilterData:function(t){var i=void 0,o=void 0,s=n.getValidFilterName(this.props.filterEffect);s&&(i=this.props.id+"_"+s,o=n.getFilterComponent(i,s),this.props.cssFiltersSupported&&(t[""].addChildren=o,e.assign(t.image.style,n.getCssStyleForFilterUse(i))))},getSkinProperties:function(){var t={position:"absolute",width:"100%"};e.isNumber(this.props.compData.opacity)&&(t.opacity=this.props.compData.opacity);var i={"":{style:{width:"100%"}},image:{style:t,"data-type":this.props["data-type"]}};return this.extendWithFilterData(i),i}}}.apply(t,o))||(e.exports=s)},340:function(e,t,i){var o,s;o=[i(0),i(5),i(3),i(2),i(1),i(6),i(341)],void 0===(s=function(e,t,i,o,s,a,n){"use strict";var r=s.mediaConsts;function p(t){return e.includes(t,"video")}return{displayName:"html5Video",mixins:[n,o.compMixins.skinBasedComp,o.compMixins.createChildComponentMixin],propTypes:e.defaults({compData:t.object.isRequired,compProp:t.object,playFullscreen:t.bool,videoRenderParts:t.array,format:t.string,config:t.object,playbackUrl:t.string,mediaQuality:t.string,notifyMediaState:t.func.isRequired,setMediaAPI:t.func.isRequired},i.santaTypesUtils.getSantaTypesByClass(a.components.Image)),getInitialState:function(){return this.playWhenReady=!1,this.hls=null,{showVideo:!1}},componentDidMount:function(){this.refs.video.addEventListener("timeupdate",this.handlePosterVisibilityOnce),this.refs.video.addEventListener("volumechange",this.onVolumeChange),this.props.notifyMediaState({type:r.eventTypes.MOUNT,playbackState:r.playbackTypes.LOADING}),p(this.props.videoRenderParts)&&(this.initAdaptive(),this.setRate(this.props.compData.playbackSpeed||1)),this.props.setMediaAPI(this.mediaAPI)},componentDidLayout:function(){this.loadSource()},componentDidUpdate:function(){p(this.props.videoRenderParts)&&(this.initAdaptive(),this.setRate(this.props.compData.playbackSpeed||1),this.props.notifyMediaState({type:r.eventTypes.LOAD,muted:this.refs.video.muted,looped:this.props.compProp.loop}))},componentWillUnmount:function(){this.props.setMediaAPI(null),p(this.props.videoRenderParts)&&(this.refs.video.removeEventListener("timeupdate",this.handlePosterVisibilityOnce),this.removeVideoSecurely())},loadSource:function(){var e=this.props.playbackUrl,t=this.props.format;("hls"===t&&this.hls?this.hls.url:this.refs.video.currentSrc)!==e&&("hls"===t&&this.hls?this.hls.loadSource(e):(this.refs.video.src=e,this.refs.video.load()))},shouldInitiateAdaptive:function(){return"hls"===this.props.format&&"maybe"!==this.refs.video.canPlayType("application/vnd.apple.mpegURL")&&!e.get(this.hls,"media")},initAdaptive:function(){if(this.shouldInitiateAdaptive()){var t=requirejs("hls-light");this.hls=new t(e.clone(this.props.config.hls)),this.hls.attachMedia(this.refs.video),this.hls.on(t.Events.ERROR,this.onHlsError)}},handlePosterVisibilityOnce:function(){!this.refs.video.paused&&this.refs.video.currentTime>0&&(this.refs.video.removeEventListener("timeupdate",this.handlePosterVisibilityOnce),this.props.notifyMediaState({type:r.eventTypes.PLAYSTATE,playbackState:r.playbackTypes.SEEK_PLAYING}),this.refs.video.addEventListener("seeked",this.setPosterState),this.seek(0))},setPosterState:function(){this.refs.video.removeEventListener("seeked",this.setPosterState),this.shouldMute()||(this.refs.video.muted=!1,this.refs.video.addEventListener("volumechange",this.onVolumeChange)),this.setState({showVideo:!0})},resetPosterState:function(){this.state.showVideo&&(this.setState({showVideo:!1}),this.refs.video.addEventListener("timeupdate",this.handlePosterVisibilityOnce))},removeVideoSecurely:function(){this.refs.video.pause(),this.hls&&(this.hls.detachMedia(),this.hls.destroy()),this.refs.video.src="",this.refs.video.load()},canVideoPlay:function(){return this.refs.video.readyState>=this.refs.video.HAVE_CURRENT_DATA},shouldMute:function(){return this.props.compProp.disableAudio||e.get(this.props,["compProp","mute"],e.get(this.props,["compData","mute"]))||!1===this.props.compData.hasAudio},play:function(){this.state.showVideo||this.shouldMute()||(this.refs.video.removeEventListener("volumeChange",this.onVolumeChange()),this.mute()),this.canVideoPlay()?this.refs.video.play():this.playWhenReady=!0},pause:function(){this.refs.video.pause()},stop:function(){this.pause(),this.seek(0),this.resetPosterState()},setVolume:function(e){this.refs.video.volume=Math.max(0,Math.min(1,e))},mute:function(){this.refs.video.muted=!0},unMute:function(){this.refs.video.muted=this.props.compProp.disableAudio},seek:function(e){this.refs.video.currentTime=Math.max(0,Math.min(e,this.refs.video.duration||this.props.compData.duration))},setRate:function(e){this.refs.video.playbackRate=Math.max(0,e)},onLoadStart:function(){this.props.notifyMediaState({type:r.eventTypes.LOAD,playbackState:r.playbackTypes.READY,volume:this.refs.video.volume,muted:this.refs.video.muted,looped:this.props.compProp.loop,currentTime:this.refs.video.currentTime,progress:0})},onDurationChange:function(){this.props.notifyMediaState({type:r.eventTypes.LOAD,duration:parseInt(100*this.refs.video.duration,10)/100})},onLoadedData:function(){this.playWhenReady||this.props.notifyMediaState({type:r.eventTypes.LOAD,playbackState:r.playbackTypes.IDLE})},onCanPlay:function(){this.playWhenReady&&(this.play(),this.playWhenReady=!1)},onTimeUpdate:function(){this.props.notifyMediaState({type:r.eventTypes.TIME_UPDATE,currentTime:this.refs.video.currentTime})},onPlayEnded:function(){this.props.notifyMediaState({type:r.eventTypes.PLAYSTATE,playbackState:r.playbackTypes.PLAY_ENDED})},onPlay:function(){this.props.notifyMediaState({type:r.eventTypes.PLAYSTATE,playbackState:r.playbackTypes.PLAYING})},onPause:function(){this.props.notifyMediaState({type:r.eventTypes.PLAYSTATE,playbackState:r.playbackTypes.PAUSED})},onHlsError:function(e,t){t.fatal&&(this.refs.video.src="",this.props.notifyMediaState({type:r.eventTypes.ERROR,error:r.errorTypes.NO_HLS_VIDEO}))},onError:function(e){e.currentTarget.networkState===e.currentTarget.NETWORK_NO_SOURCE?(this.refs.video.src="",this.props.notifyMediaState({type:r.eventTypes.ERROR,error:r.errorTypes.NO_VIDEO_FOUND})):this.props.notifyMediaState({type:r.eventTypes.ERROR,error:r.errorTypes.VIDEO_GENERAL_ERROR})},onProgress:function(){var e=this.refs.video.buffered;this.props.notifyMediaState({type:r.eventTypes.PROGRESS,progress:e&&e.length?e.end(e.length-1):0})},onSeekStart:function(){this.props.notifyMediaState({type:r.eventTypes.PLAYSTATE,playbackState:r.playbackTypes.SEEKING})},onSeekEnd:function(){this.props.notifyMediaState({type:r.eventTypes.PLAYSTATE,playbackState:r.playbackTypes.SEEKING_ENDED})},onVolumeChange:function(){this.props.notifyMediaState({type:r.eventTypes.VOLUME,volume:this.refs.video.volume,muted:this.refs.video.muted})},onRateChange:function(){this.props.notifyMediaState({type:r.eventTypes.RATE,playbackRate:this.refs.video.playbackRate})},onVideoClick:function(e){e.stopPropagation()},getVideo:function(){var e={preload:this.props.compData.preload||"none",onEnded:this.onPlayEnded,onError:this.onError,onLoadStart:this.onLoadStart,onLoadedData:this.onLoadedData,onCanPlay:this.onCanPlay,onDurationChange:this.onDurationChange,onPause:this.onPause,onPlay:this.onPlay,onProgress:this.onProgress,onRateChange:this.onRateChange,onSeeked:this.onSeekEnd,onSeeking:this.onSeekStart,onTimeUpdate:this.onTimeUpdate,onClick:this.onVideoClick,playsInline:!this.props.playFullscreen,style:{opacity:this.state.showVideo?1:0}};return this.props.compData.alt&&(e["aria-label"]=this.props.compData.alt),this.shouldMute()&&(e.muted="muted"),e},getRenderParts:function(){var t=this,i={video:null,poster:null};return e.forEach(this.props.videoRenderParts,function(e){switch(e){case"video":i.video=t.getVideo();break;case"poster":i.poster=t.getPosterImageComp(t.props.compData.posterImageRef,t.state.showVideo)}}),i},getSkinProperties:function(){var e=this.getRenderParts();return{"":{"data-quality":this.props.mediaQuality,"data-player-type":"html5",style:{width:"100%"}},video:e.video,poster:e.poster}}}}.apply(t,o))||(e.exports=s)},341:function(e,t,i){var o,s;o=[i(0),i(1),i(6)],void 0===(s=function(e,t,i){"use strict";var o=t.mediaConsts;return{mixins:[i.mixins.animationsMixin],externalAPI:["play","pause","stop","seek","setVolume","mute","unMute","setRate","setSrc"],mediaAPI:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=this[t];o&&e.includes(this.externalAPI,t)&&o.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(i))},getPosterImageComp:function(t,i,s){var a={};return i&&"fade"===this.props.compProp.animatePoster?this.animate(this.refs.poster,"BaseFade",1.6,0,{opacity:0,ease:"Quad.easeOut"}):a.opacity=i?0:1,this.createChildComponent(t,"core.components.Image",o.balataConsts.POSTER,e.assign({ref:o.balataConsts.POSTER,key:a.backgroundColor?"posterImagePng":"posterImage",id:this.props.id+o.balataConsts.POSTER,imageData:t,displayMode:this.props.compData.fittingType,alignType:this.props.compData.alignType,containerWidth:0,containerHeight:0,style:a},s))}}}.apply(t,o))||(e.exports=s)},4:function(e,t){e.exports=s},5:function(e,t){e.exports=a},6:function(e,t){e.exports=n},61:function(e,t){e.exports=d},67:function(e,t){e.exports=l},692:function(e,t,i){var o,s;o=[i(693),i(339),i(694),i(695),i(340),i(696),i(2),i(7),i(698)],void 0===(s=function(e,t,i,o,s,a,n,r,p){"use strict";var d={mixins:{backgroundDetectionMixin:e},components:{bgImage:t,bgMedia:i,bgOverlay:o,html5Video:s,iframeVideo:a}};return n.compRegistrar.register("wysiwyg.viewer.components.background.bgMedia",d.components.bgMedia).register("wysiwyg.viewer.components.background.bgImage",d.components.bgImage).register("wysiwyg.viewer.components.background.html5Video",d.components.html5Video).register("wysiwyg.viewer.components.background.iframeVideo",d.components.iframeVideo).register("wysiwyg.viewer.components.background.bgOverlay",d.components.bgOverlay),r.skinsMap.addBatch(p),d}.apply(t,o))||(e.exports=s)},693:function(e,t,i){var o,s;o=[i(0),i(1),i(4),i(61),i(3)],void 0===(s=function(e,t,i,o,s){"use strict";function a(t){return e.get(t.compDesign,"background")||e.get(t.compData,"background",{})}function n(){var e=a(this.props);return new o(t.colorParser.getColor(this.props.colorsMap,e.color,e.colorOpacity))}function r(e,t){var o=e&&e.uri,s=o!==this.lastBackgroundImageUrl,a=t&&t.hexString(),r=this.lastBackgroundBgColor&&this.lastBackgroundBgColor.hexString(),p=!o&&a!==r,d=t&&t.values.alpha!==this.lastAlpha;(s||p||d)&&function(e){var t=e&&e.uri;if(t){var o={id:t,width:e.width,height:e.height},s=i.imageClientApi,a=s.getData(s.fittingTypes.SCALE_TO_FILL,o,{width:1,height:1}).uri,r=this.props.getMediaFullStaticUrl(a);this.props.updateImageInfo(this.props.id,this.props.rootId,r)}else{var p=n.call(this);this.props.updateColorInfo(this.props.id,this.props.rootId,{brightness:p.values.hsv[2],alpha:p.values.alpha})}}.call(this,e),this.lastBackgroundImageUrl=o,this.lastBackgroundBgColor=t,this.lastAlpha=t.values.alpha}return{propTypes:{id:s.Types.Component.id,compDesign:s.Types.Component.compDesign,compData:s.Types.Component.compData,colorsMap:s.Types.Theme.colorsMap.isRequired,isMobileView:s.Types.isMobileView.isRequired,updateColorInfo:s.Types.VerticalAnchorsMenu.updateInformation.isRequired,updateImageInfo:s.Types.VerticalAnchorsMenu.updateImageInfo.isRequired,getMediaFullStaticUrl:s.Types.ServiceTopology.getMediaFullStaticUrl.isRequired},componentDidMount:function(){if(!this.props.isMobileView){var e=n.call(this),t=this.getMediaImageData();r.call(this,t,e)}},componentDidUpdate:function(){if(!this.props.isMobileView){var e=n.call(this),t=e&&e.hexString(),i=this.lastBackgroundBgColor&&this.lastBackgroundBgColor.hexString(),o=this.getMediaImageData(),s=t!==i,a=(o&&o.uri)!==this.lastBackgroundImageUrl,p=e&&e.values.alpha!==this.lastAlpha;(s||a||p)&&r.call(this,o,e)}},getMediaImageData:function(){var e=a(this.props).mediaRef;if(e)switch(e.type){case"Image":return e;case"WixVideo":return e.posterImageRef}return null}}}.apply(t,o))||(e.exports=s)},694:function(e,t,i){var o,s;o=[i(0),i(5),i(2),i(3),i(6),i(27),i(339),i(340),i(4)],void 0===(s=function(e,t,i,o,s,a,n,r,p){"use strict";var d=i.compMixins,l=p.containerBackgroundUtils,c=p.mediaConsts,u=p.svgFilters,y=[a.fittingTypes.TILE],h={comp:"wysiwyg.viewer.components.background.bgImage",skin:"skins.viewer.bgImage.bgImageSkin",style:"bgImage","data-type":c.balataConsts.BG_IMAGE},m={comp:"core.components.Image",skin:"skins.core.ImageNewSkinZoomable",style:"bgImage","data-type":c.balataConsts.IMAGE},f={comp:"wysiwyg.viewer.components.background.html5Video",skin:"skins.viewer.bgVideo.html5VideoSkin",style:"bgVideo"},g={comp:"wysiwyg.viewer.components.background.iframeVideo",skin:"skins.viewer.bgVideo.iframeVideoSkin",style:"iframeVideo"};function v(t){var i=t.compData,o=void 0,s=function(t,i,o){o=o||{};var s=u.isFilterExists(o.effectType);return e.includes(y,t)&&(!s||s&&i)?h:m}(t.fittingType,t.cssFiltersSupported,t.filterEffect),a={image:{id:t.id+c.balataConsts.CONTENT,componentType:s.comp,skinPartData:{skin:s.skin,styleId:s.style},compData:i},poster:{id:t.id+c.balataConsts.CONTENT,componentType:s.comp,skinPartData:{skin:s.skin,styleId:s.style},compData:i.posterImageRef},video:{id:t.id+c.balataConsts.CONTENT,componentType:f.comp,skinPartData:{skin:f.skin,styleId:f.style},compData:i},iframe:{id:t.id+c.balataConsts.CONTENT,componentType:g.comp,skinPartData:{skin:g.skin,styleId:g.style},compData:i}};switch(i.type){case"Image":o=a.image;break;case"WixVideo":o=t.enableVideo?a.video:a.poster;break;case"Video":switch(i.videoType){case"YOUTUBE":o=a.youtube}}return o}return{displayName:"bgMedia",mixins:[d.skinBasedComp,d.createChildComponentMixin],propTypes:e.defaults({id:t.string.isRequired,compData:t.object.isRequired,compProp:t.object,alignType:t.string,fittingType:t.string,mediaTransforms:t.object,filterEffect:t.object,bgEffectName:t.string,style:t.object.isRequired,isPlayingAllowed:t.bool,enableVideo:t.bool,mediaQuality:t.string,renderParts:t.object,notifyMediaState:t.func,setMediaAPI:t.func,cssFiltersSupported:o.Types.BrowserFlags.cssFiltersSupported.isRequired,renderFixedPositionBackgrounds:o.Types.RenderFlags.renderFixedPositionBackgrounds},o.santaTypesUtils.getSantaTypesByClass(s.components.Image),o.santaTypesUtils.getSantaTypesByDefinition(n),o.santaTypesUtils.getSantaTypesByDefinition(r)),getDefaultSkinName:function(){return"skins.viewer.balata.bgMediaSkin"},getMediaComponent:function(){var t=v(this.props),i=function(e,t){var i={};return t===h.comp?i={ref:c.balataConsts.CONTENT,filterEffect:e.filterEffect,"data-type":h["data-type"]}:t===m.comp?i={ref:c.balataConsts.CONTENT,key:"img_"+e.bgEffectName,containerWidth:0,containerHeight:0,imageData:e.compData,filterEffect:e.filterEffect,displayMode:e.fittingType,fittingType:e.fittingType,alignType:e.alignType,"data-type":m["data-type"]}:t!==f.comp&&t!==g.comp||(i={ref:c.balataConsts.CONTENT,key:"vid_"+e.compData.videoId,notifyMediaState:e.notifyMediaState,isPlayingAllowed:e.isPlayingAllowed,setMediaAPI:e.setMediaAPI,mediaQuality:e.mediaQuality,format:e.playbackFormat,config:e.playbackConfig,playbackUrl:e.playbackUrl,videoRenderParts:e.renderParts.media.video,compProp:e.compProp}),i}(this.props,t.componentType),o=e.assign({id:t.id},i);return this.createChildComponent(t.compData,t.componentType,t.skinPartData,o)},getSkinProperties:function(){var t=l.getPositionByEffect(this.props.bgEffectName,this.props.renderFixedPositionBackgrounds),i=e.assign({},this.props.style,{position:t,pointerEvents:this.props.bgEffectName?"none":"auto",top:0}),o=e.mapKeys(this.props.mediaTransforms,function(e,t){return"data-"+t});return{"":e.assign({key:["media",this.props.isPlayingAllowed?"playback":"no_playback",this.props.enableVideo?"video":"no_video"].join("_"),children:this.getMediaComponent(),style:i,"data-effect":this.props.bgEffectName||"none","data-fitting":this.props.fittingType,"data-align":this.props.alignType},o)}}}}.apply(t,o))||(e.exports=s)},695:function(e,t,i){var o,s;o=[i(5),i(0),i(4),i(27),i(2),i(1),i(3)],void 0===(s=function(e,t,i,o,s,a,n){"use strict";function r(e){var i=e.colorOverlay?{backgroundColor:a.colorParser.getColor(e.colorsMap,e.colorOverlay,e.colorOverlayOpacity)}:{},o=function(e){var t=e.bgEffectName,i=e.fixedBackgroundColorBalata,o=e.renderFixedPositionBackgrounds;return i&&a.containerBackgroundUtils.isFullScreenByEffect(t,o)}(e)?{top:0,position:"fixed"}:{position:"absolute"},s=e.blendMode?{mixBlendMode:e.blendMode}:{};return t.assign({width:"100%",height:"100%"},i,o,s,e.style)}return{displayName:"bgOverlay",mixins:[s.compMixins.skinBasedComp],propTypes:{style:e.object,colorOverlay:e.string,colorOverlayOpacity:e.number,imageOverlay:e.object,bgEffectName:e.string,blendMode:e.string,blendModeOpacity:e.number,mixBlendModeSupported:n.Types.BrowserFlags.mixBlendModeSupported.isRequired,colorsMap:n.Types.Theme.colorsMap.isRequired,fixedBackgroundColorBalata:n.Types.BrowserFlags.fixedBackgroundColorBalata.isRequired,renderFixedPositionBackgrounds:n.Types.RenderFlags.renderFixedPositionBackgrounds,currentUrl:n.Types.currentUrl,getMediaFullStaticUrl:n.Types.ServiceTopology.getMediaFullStaticUrl},componentDidLayout:function(){var e=this.refs[a.balataConsts.OVERLAY];e.style.backgroundImage=e.dataset.backgroundImage},getSkinProperties:function(){return function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({"":{style:r(this.props)}},a.balataConsts.OVERLAY,{"data-background-image":function(e){var t=e.imageOverlay,s=e.getMediaFullStaticUrl,a=e.currentUrl;if(t){var n={imageData:e.imageOverlay,containerWidth:e.imageOverlay.width,containerHeight:e.imageOverlay.height,displayMode:o.fittingTypes.TILE};return"url("+i.imageUtils.getImageComputedProperties(o,n,s,a,1,o.htmlTag.BG).uri+")"}return""}(this.props),style:function(e){var i=function(e){var t=e.blendMode,i=e.mixBlendModeSupported,o=e.blendModeOpacity;return t?{opacity:i||"overlay"!==t?o:o/2}:{}}(e);return t.assign({width:"100%",height:"100%",position:"absolute"},i)}(this.props)})}}}.apply(t,o))||(e.exports=s)},696:function(e,t,i){var o,s;o=[i(697)],void 0===(s=function(e){"use strict";return e.getIframeVideoComponent({iframeUrl:"https://wix-private.github.io/video-fx-player/360.html",apiId:"wix-video-fx-player",displayName:"iframeVideo"})}.apply(t,o))||(e.exports=s)},697:function(e,t,i){var o,s;o=[i(0),i(5),i(2),i(3),i(1),i(67),i(6),i(341)],void 0===(s=function(e,t,i,o,s,a,n,r){"use strict";var p=s.mediaConsts;return{getIframeVideoComponent:function(d){var l=d.iframeUrl,c=d.apiId,u=d.displayName;return{displayName:void 0===u?"iframeVideo":u,mixins:[r,i.compMixins.skinBasedComp,i.compMixins.createChildComponentMixin],propTypes:e.defaults({compData:t.object.isRequired,compProp:t.object,isPlayingAllowed:t.bool,mediaQuality:t.string,notifyMediaState:t.func.isRequired,setMediaAPI:t.func.isRequired,staticVideoUrl:o.Types.ServiceTopology.staticVideoUrl},o.santaTypesUtils.getSantaTypesByClass(n.components.Image)),getInitialState:function(){return this.player=null,this.eventHandlers=[],{loadVideo:!1,showVideo:!1}},componentDidMount:function(){this.props.setMediaAPI(this.mediaAPI),this.props.notifyMediaState({type:p.eventTypes.MOUNT,playbackState:p.playbackTypes.LOADING}),this.props.compProp.autoplay&&this.props.isPlayingAllowed&&this.play()},componentDidUpdate:function(){this.setRate(this.props.compData.playbackSpeed||1)},componentWillUnmount:function(){this.props.setMediaAPI(null),this.removeVideoSecurely()},getUrl:function(t,i){var o="https://video.wixstatic.com/";if(!i)return"";var a=e.find(t.qualities,{quality:i});return a.url?s.urlUtils.joinURL(o,a.url):s.urlUtils.joinURL(o,t.videoId,i,"mp4","file.mp4")},onVideoFrameReady:function(){var e=this,t=this.getUrl(this.props.compData,this.props.mediaQuality);a.api.request(c,{target:this.refs.video}).then(function(i){e.player=i,e.player.set(t,{loop:!1,mute:e.props.compProp.mute||!1===e.props.compData.hasAudio,autoplay:!0,rate:e.props.compData.playbackSpeed||1,preload:e.props.compData.preload||"none"},e.onVideoEvent),e.addVideoEventListener("timeupdate",e.handlePosterVisibilityOnce),e.addVideoEventListener("ended",e.onPlayEnded),e.addVideoEventListener("error",e.onError),e.addVideoEventListener("loadstart",e.onLoadStart),e.addVideoEventListener("durationchange",e.onDurationChange),e.addVideoEventListener("pause",e.onPause),e.addVideoEventListener("play",e.onPlay),e.addVideoEventListener("progress",e.onProgress),e.addVideoEventListener("ratechange",e.onRateChange),e.addVideoEventListener("seeked",e.onSeekEnd),e.addVideoEventListener("seeking",e.onSeekStart),e.addVideoEventListener("stalled",e.onStalled),e.addVideoEventListener("timeupdate",e.onTimeUpdate),e.addVideoEventListener("volumechange",e.onVolumeChange)}).catch(function(e){console.log("Video API not loaded.",e)})},addVideoEventListener:function(t,i){if(!e.find(this.eventHandlers,{eventType:t,handler:i}))return this.eventHandlers.push({eventType:t,handler:i}),!0},removeVideoEventListener:function(t,i){if(e.find(this.eventHandlers,{eventType:t,handler:i}))return this.eventHandlers=e.reject(this.eventHandlers,{eventType:t,handler:i}),!0},onVideoEvent:function(t){var i=e.filter(this.eventHandlers,{eventType:t.type});e.forEach(i,function(e){e.handler(t)})},handlePosterVisibilityOnce:function(e){e.currentTime>0&&(this.removeVideoEventListener("timeupdate",this.handlePosterVisibilityOnce),this.setState({showVideo:!0}))},resetPosterState:function(){this.state.showVideo&&(this.setState({showVideo:!1}),this.addVideoEventListener("timeupdate",this.handlePosterVisibilityOnce))},removeVideoSecurely:function(){this.player&&(this.eventHandlers=[],this.player.reset())},play:function(){this.player?this.player.play():this.setState({loadVideo:!0})},pause:function(){this.player&&this.player.pause()},stop:function(){this.player&&(this.pause(),this.seek(0),this.resetPosterState())},setVolume:function(e){this.player&&this.player.setVolume(e)},mute:function(){this.player&&this.player.setMute(!0)},unMute:function(){this.player&&this.player.setMute(!1)},seek:function(e){this.player&&this.player.seek(e)},setRate:function(e){this.player&&this.player.setRate(e)},onLoadStart:function(e){this.props.notifyMediaState({type:p.eventTypes.LOAD,playbackState:p.playbackTypes.READY,volume:e.volume,muted:e.muted,looped:this.props.compProp.loop,currentTime:e.currentTime,progress:0})},onDurationChange:function(e){this.props.notifyMediaState({type:p.eventTypes.LOAD,duration:e.duration})},onTimeUpdate:function(e){this.props.notifyMediaState({type:p.eventTypes.TIME_UPDATE,currentTime:e.currentTime})},onPlayEnded:function(){this.props.notifyMediaState({type:p.eventTypes.PLAYSTATE,playbackState:p.playbackTypes.PLAY_ENDED})},onPlay:function(){this.props.notifyMediaState({type:p.eventTypes.PLAYSTATE,playbackState:p.playbackTypes.PLAYING})},onPause:function(){this.props.notifyMediaState({type:p.eventTypes.PLAYSTATE,playbackState:p.playbackTypes.PAUSED})},onError:function(e){e.networkState===e.NETWORK_NO_SOURCE?this.props.notifyMediaState({type:p.eventTypes.ERROR,error:p.errorTypes.NO_VIDEO_FOUND}):this.props.notifyMediaState({type:p.eventTypes.ERROR,error:p.errorTypes.VIDEO_GENERAL_ERROR})},onStalled:function(e){e.readyState===e.HAVE_NOTHING&&this.props.notifyMediaState({type:p.eventTypes.ERROR,error:p.errorTypes.NO_VIDEO_FOUND})},onProgress:function(e){this.props.notifyMediaState({type:p.eventTypes.PROGRESS,progress:e.progress})},onSeekStart:function(){this.props.notifyMediaState({type:p.eventTypes.PLAYSTATE,playbackState:p.playbackTypes.SEEKING})},onSeekEnd:function(){this.props.notifyMediaState({type:p.eventTypes.PLAYSTATE,playbackState:p.playbackTypes.SEEKING_ENDED})},onVolumeChange:function(e){this.props.notifyMediaState({type:p.eventTypes.VOLUME,volume:e.volume,muted:e.muted})},onRateChange:function(e){this.props.notifyMediaState({type:p.eventTypes.RATE,playbackRate:e.playbackRate})},getVideo:function(){return n.utils.createReactElement("iframe",{ref:"video",id:this.props.id+"video",frameBorder:0,allowFullScreen:!0,"data-src":this.state.loadVideo?l:"about:blank",onLoad:this.onVideoFrameReady})},getSkinProperties:function(){var e=this.getPosterImageComp(this.props.compData.posterImageRef,this.state.showVideo);return{"":{"data-quality":this.props.mediaQuality,"data-player-type":"iframe",style:{width:"100%"}},video:this.getVideo(),poster:e}}}}}}.apply(t,o))||(e.exports=s)},698:function(e,t,i){var o;void 0===(o=function(){"use strict";var e={"skins.viewer.bgImage.bgImageSkin":{react:[["div","image",[],{}]],css:{}},"skins.viewer.bgMedia.bgMediaSkin":{react:[],css:{}},"skins.viewer.bgOverlay.bgOverlaySkin":{react:[["div","overlay",[],{}]]},"skins.viewer.bgVideo.html5VideoSkin":{react:[["video","video",[],{role:"presentation"}],["div","poster",[],{}]],exports:{poster:{skin:"skins.core.ImageNewSkinZoomable"}},css:{}},"skins.viewer.bgVideo.iframeVideoSkin":{react:[["div","video",[],{}],["div","poster",[],{}]],exports:{poster:{skin:"skins.core.ImageNewSkinZoomable"}},css:{}}};return e}.apply(t,[]))||(e.exports=o)},7:function(e,t){e.exports=r}})});
//# sourceMappingURL=backgroundCommon.min.js.map